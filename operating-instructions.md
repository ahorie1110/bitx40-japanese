## Raduino_v1.27対応 ユーザー・ガイド　(作成中)

【重要】　このスケッチ（ソフトウエア）のバージョンは割込み処理のため ["PinChangeInterrupt"](https://playground.arduino.cc/Main/PinChangeInterrupt) のライブラリが必要です。このスケッチをコンパイルする前に、お使いのIDEにこのライブラリを[インストール](library-install.md)してください。

このバージョンでファームウエアを更新すると、BITX40の全てのキャリブレーション・データ、ドライブレベル等の設定は全て初期値に設定されます。更新する前に現在のキャリブレーション・データ等をメモしておいてください。更新が完了したら、“ファンクションボタン” を使用して、初期値からメモしておいた設定に戻してください。このスケッチでは基本的なLSBの機能はハードウエアの改造を行わなくても動作します。必要な（最小限の）ハードウエアの改造を行えば、ユーザーの選択により機能を追加して、このソフトウエアにより動作させることができます。それぞれの機能で必要なハードウエアの改造を以下のテーブルに示します。それぞれの改造の詳細は以下を参照してください。

![Table of hardware modifications](https://github.com/ahorie1110/bitx40-japanese/blob/master/hard.jpg)

## 10-TURN TUNING POT
(10回転チューニング・ポット)

キットに付属のチューニング・ポットは１回転しかできず、１回転でチューニングできる周波数スパンの初期値は50KHです。
代わりに10回転できるチューニング・ポット（ポテンション・メータ）を使用すれば7MHz帯全体を容易にチューニングできるよう1回転当たりの周波数スパンを拡げることができます。

![Image of 10-turn pot hookup](Vishay%20100K%2C%2010-turn%20pot%20wire%20up.jpg)

“ファンクションボタン”を使用して、“SETTINGS”メニューから[希望のポットスパンを設定する](#tuning-range)。

## FUNCTION BUTTON WIRING:
（ファンクションボタンの配線）

モーメンタリー・プッシュボタンをA3ピン（P1コネクタのオレンジ線）とグランドに接続します。Arduinoの内部プルアップ抵抗を使用しますので、外部プルアップ抵抗は必要ありません。

“ファンクションボタン”はまだありませんか？もし、プッシュボタンを使用しない場合には、基本的なLSB機能は動作します（もちろん、この場合にはDual VFO,RIT,USB,CW　などの機能は使えませんが）。但し、キャリブレーションは“CAL”ボタン（P1コネクタのA2ピン、赤線）を使用する従来の方法で行えます。設定幅は34～36行のコードを希望する値に書き換えることよって設定することができます。再コンパイルしてRaduinoにファームウエアを書き込んだら、新しい設定を初期化するために一時的に”CAL”の赤線をグランドに接続します。

## PIN LAYOUT
(ピン配置)

![Raduino pin layout](raduino_pin_layout.png)

### Connector P1 (8 pin)

* A0 (黒): PTTSense
* A1 (茶): Key, "dit"
* A2 (赤): CAL
* A3 (橙): Function Button
* GND (黄色)
* +5V (緑)
* A6 (青): unused
* A7 (紫): Tuning Pot

### Connector P3 (16 pin)

最初の11ピンはヘッダがありません（パッドのみ）：
ハードウエアのバージョンによってはコネクタピンになっています。
* D7: TX-RX
* D6: CW Carrier
* D5: CW Side Tone
* D4: CW SPOT Button
* D3: Key, "dah"
* ??: Unused
* ??: Unused
* ??: Unused
* ??: Unused
* ??: Unused
* ??: Unused

５ピンヘッダ

* GND (black)
* GND (brown)
* CLK2 (red)
* +5V (orange)
* ?? (yellow): Unused


## PTT SENSE WIRING:
（PTT検出の配線）

A0ピン（P1コネクタの黒線）を直列に接続した10Kの抵抗を介してBITX40のU3(レギュレータLM7805)の出力に接続します。

![PTT Sense wiring](PTT%20SENSE%20wiring.png)

PTTが押されていないときは（受信モード）、レギュレータはOFFとなりA0ピンは0V（LOW）となります。PTTが押されると（送信モード）レギュレータはONとなりA0ピンは+5V(HIGH)となります。PTT検出は、CW、RIT、SPLITや送信中（“FM-ing”を防ぐ）の周波数変更を行えないようにするために必要です。PTT検出の改造を行なわない場合でも、LSBとUSBでの運用は問題なく動作します。

## CONNECTING A STRAIGHT MORSE KEY or 'TUNE' BUTTON:
（ストレートCWキーまたは“TUNE”ボタンの配線）

ストレートCWキー（または外部エレクトリックキー）をRaduinoのA1ピン（P1コネクタの茶線）に接続することができます。Raduinoの入力を保護するために1Kの抵抗を接続することをお勧めします。キーが押されていない場合（オープン）にはA1ピンは“HIGH”になり、キーが押された場合（クローズ、グランドに短絡）にはA1ピンは“LOW”になり、そしてキャリアが送信されます。

CWキーの代わりにシンプルな押しボタンを接続することもできます。発生されたCWキャリアはアンテナの調整に使用することができます。但し、この場合にはCWキャリアは連続で出力されますのでご注意ください。従って、終段がオーバヒートしないように“TUNE”ボタンを長時間押さないようにしてください。

## AUTOMATIC KEYER - CONNECTING A PADDLE:
（エレキー、パドルの接続）

Raduinoは初期値ではストレートキーを使用するよう設定されています。エレキーを使用したい場合には“SETTINGS”メニューで　'CW parameters' => 'Key-type'
and select 'paddle', 'rev. paddle' (左利き用), 'bug', or 'rev.
bug'の順番で選択します。“dit”接点をRaduinoのA1ピン（P1コネクタの茶線）に接続し、“dah”接点をRaduinoのD3ピン（P3コネクタ）に接続します。Arduinoの入力を保護するために、1Kの抵抗を直列につなぐことをお勧めします。内蔵キーヤーは“IambicモードA”と 'bug'モード（Vibroplexエミュレーション）があり、パドルを逆にすることができます。

## ADJUSTING CW KEYER SPEED
(CWキーの速度調整)

CWキーの速度は、フロントパネル（範囲1〜50 WPM）で設定できます。 キーを押しながらファンクションボタンを押して離すと速度が上がり、SPOTボタンを押すと速度が下がります。 CW速度設定はEEPROMに保持されます。

## CAPACITIVE TOUCH KEYER:
（容量式タッチ・キー）
このスケッチでは容量式タッチ機能をサポートしています。この機能によって、ストレートキーやパドルの代わりにタッチセンターを使用することができます。タッチセンーによってストレートキーや同様にエレキーの運用が可能です。次のURLのYoutubeのデモを見てください：https://www.youtube.com/watch?v=9MWM6UVy9k4

この機能のためには最低限の改造として４つの抵抗を接続する必要があります。注）電源立上げ時にタッチセンサーが正確に動作しないという現象が何件か報告されています。このような場合には、内部のベース静電容量を若干増やすために3～22pFの小さなコンデンサを両方の入力に接続します。

![Capacitive Touch Keyer Mod](capacitive%20touch%20keyer%20modification.png)

初期値では静電式タッチセンサーは無効になっています。タッチセンサーを使用する場合には、“SETTINGS”メニューから'CW parameters' => 'Touch
sensor'を選択し、希望するタッチセンサーの感度をチューニング・ノブで設定します。

タッチセンサーの良好な感度の開始値は“22”です。感度をより高めるには値を上げ、最大値は“25”です。感度の設定はとても繊細で個人の好みにもよります。通常はより高い感度が良い結果を得られます。しかしながら、感度が高すぎると電気的ノイズやタッチパッドの周囲環境によりキーが誤動作してしまうかもしれません。また、１回しかパッドにタッチしていなくても、“スクイズ・キーイング”が生じてしまうかもしれません。一方、感度が低すぎる場合には、タッチパッドの操作にキーヤーが正しく反応せず、例えば“ダブルDITやDAH”が発生してしまうかもしれません。最良の設定を見つけるには少し実験が必要になるでしょう。

タッチセンサーは起動時に自動的にキャリブレーションされます。 再度キャリブレーションしたい場合は、センサパッドに触れないで、単に電源を切ってから再度電源を入れます。
センサーキャリブレーションデータは、起動時にLCDディスプレイに表示されます。注：タッチキーヤーが有効な場合、通常のパドル操作はできません。
標準のパドルを使用する場合は、感度を0（タッチセンサーOFF）に設定してタッチセンサーを無効にします。

## CW-CARRIER WIRING:
（CWキャリアの配線）
CW運用を行うか、アンテナ調整のためのキャリアを発生させたい場合には、この改造が必要です。Raduinoの出力D6（P3コネクタの15ピン）を直列に配線した4.7Kの抵抗を介して、ミキサの入力に配線します。

![CW Carrier Wiring](CW-CARRIER%20wiring.png)

キーが押されているときには出力D6は“HIGH”になります。このとき、ミキサが不平衡になるようにミキサに若干の直流電流が流れます。その結果、CWキャリアが発生します。

注）最大出力時にキャリアが発生しない場合には、ドライブを増加させるために4.7Kの抵抗をより小さな値に変える必要があるでしょう。しかしながら、綺麗なCW信号を発生させるために可能な限り高い抵抗のままとしてください。決して1Kの抵抗は使用しないでください。アンテナ調整のチューニング用だけならば、キャリアは低いほうが望ましいです。この場合、100Kの抵抗を4.7Kの抵抗に直列に接続し、キャリアの強さを適切な強さに抑えることができます。

この“CWキャリア”の改造はCW機能にのみ必要です。この改造を行わなければ、他の機能は問題なく動作します。

## CW SIDE TONE WIRING:
（CWサイドトーンの配線）
サイドトーンはRaduinoのD5出力（P3コネクタの14ピン）より出力できます。サイドトーンは外部オーディオアンプへの出力と並行にスピーカ／ヘッドホンへ出力されます。

![CW Side Tone Wiring](sidetone%20wiring.png)

希望するサイドトーンのピッチは“SETTINGS”メニューの“ファンクション・ボタン”で設定できます。サイドトーンはCW運用のときのみ使用されます。サイドトーンの改造を行わなくても、他の全ての機能は問題なく動作します。

## TX-RX WIRING:
(CW用PTTバイパス配線）

![TX-RX Wiring](TX-RX%20line%20wiring.png)

この改造はCW運用で必要です。

CWキーが押されると出力D7（P3コネクタの15ピン）は“HIGH”になります。CWキーが少なくとも350msの間離れたときのみ出力は再び“LOW”になります（この時間は“SETTINGS”メニューで設定することができます）。出力D7は、CWモードで動作中にPTTのスイッチングをバイパス（無効）するために、PTTスイッチと並列に接続されたNPNトランジスタをドライブするために使用されます。これにより出力D7が“HIGH”の間はリレーが動作します。（ヒント：マイクとPTTを一緒のコネクタにしている場合は、PTTバイパス用トランジスタはその背面に直接はんだ付けできます。PTTバイパス用トランジスタは将来VOX機能を使用する場合にも同様に使用します）

## CW SPOT/FINE TUNE Button:
（CW ゼロ・ビートボタン）

D4ピン（P3コネクタ）とグランドの間にモーメンタリー・プッシュボタンを配線します。Arduinoの内部のプルアップ抵抗を使用しますので、外部のプルアップ抵抗を用いる必要はありません。CWで運用するときには、両方の局が同一の周波数でキャリアを送信することが大切です。受信モードの時に“SPOT”ボタンが押されると、RITがOFFになりサイドトーンが生成されます（キャリアは送信されません）。

“SPOT”ボタンが押されている間、VFOを1Hzの精度にセットできる“FINE TUNE”モードになります。この機能はSSBモードでも同様に使用できます（但しこの場合にはサイドトーンは生成されません）。受信しているCW信号とCWのトーンのピッチが一致するようにチューニング・ポットを調整します。受信しているCW信号のピッチをCWトーンと合わせることにより、自局の信号と他局の信号を完全に同一の周波数にすることができます（ゼロ・ビート）。（“SPOT”とボタンは付加的な機能であって、CW運用で必須の機能ではありません。“SPOT”ボタンがなくても、CW運用は可能です）

## DIAL LOCK FUNCTION
(ダイアル・ロック)

“ファンクションボタン“と“SPOT”ボタンを同時に押すとダイアルをロックすることができます。ダイアルがロックされると“チューニング”ができなくなりますが、PTTとCWは動作します。ロックを解除するには、再び“ファンクションボタン”を押します。

## SPURIOUS BURST PREVENTION
（スプリアス・バーストとの防止）

受信から送信に切り替わる際のスプリアス・バーストの発生を防ぐために、短時間の遅延（TX_DELAY）を設定しています。TX_DELAYは初期値では65msに設定され、必要に応じて71行を変更すればこの遅延時間を調整することができます。

## FUNCTION BUTTON USAGE:
（ファンクションボタンの使用方法）

いくつかの機能はプッシュボタンのみで設定することができます。
必要なハードウエアの改造が行われていない場合には、いくつかのメニューは表示されません。
 
## 運用モード
通常の運用モードの場合：
* 短く１回押す　―　VFO A/Bの切替
* 短く２回押す　―　RIT ON、“ファンクションボタン”を再度押すとRIT OFF（この機能を使用するにはPTT検出の改造が必要）
* 短く３回押す　―　SPLIT ON/OFFの切替（この機能を使用するにはPTT検出の改造が必要）
* 短く４回押す　―　LSB-USB-CWL-CWUのモード変更　（ボタンの回転で順番にセレクト）
* 短く５回押す　―　周波数SCANモードの開始
* 短く６回押す　―　VFO　A/Bモニタリングモードの開始
* 長く押す（1秒以上）　―　VFO AとBを同じにする

## 設定モード

“SETTINGS”メニューに入るには３秒以上ファンクションボタンを押します。


### 周波数スキャン

１回短くボタンを押して周波数SCANのパラメータを設定します（下限、上限、ステップ幅、ステップ遅延）

- チューニング・ポットを使用して、スキャンの下限の周波数を設定する
- ファンクションボタンを押す
- チューニング・ポットを使用して、スキャンの上限の周波数を設定する
- ファンクションボタンを押す
- チューニング・ポットを使用して、スキャンのステップ幅を設定する
- ファンクションボタンを押す
- チューニング・ポットを使用して、スキャンの遅延幅を設定する（A/Bモニタリングモードでも使用）
- ファンクションボタンを押して、設定を記録する。


### ＣＷの設定

2回短くボタンを押してＣＷのパラメータを設定します（サイドトーン・ピッチ、CWキータイプ、セミQSK　ON/OFF）

＊この機能を使用するにはPTT検出の改造が必要です。

- チューニング・ノブを使用して、CWキー使用時には“straight”、エレキー使用時には”paddle”、左利き用には“rev.paddle”、あるいは”bug”または”reb.bug”を選択する
- ファンクションボタンを押す
- チューニング・ポットを使用して、Auto-space ON/OFFを選択する
  ＊エレキーが選択されているときのみ
- ファンクション・ボタンを押す
- チューニング・ポットを使用して、タッチ・キーの感度を設定する（0=OFF）
　＊タッチセンサーの改造がされている場合のみ
- ファンクションボタンを押す
- チューニング・ポットを使用して、semiQSK　ON/OFFを選択する
　＊CW・PTTバイパスの改造が行われている場合のみ
- ファンクションボタンを押す
- チューニング・ポットを使用して、タイムアウト時間（ms）を設定する
　＊semiQSKがONの場合のみ
- ファンクションボタンを押して、設定を記録する。
- チューニング・ポットを使用して、サイドトーン・ピッチを設定する
- ファンクションボタンを押す


### VFOキャリブレーション、LSB

３回、短くボタンを押す－LSBモードでのVFO周波数のキャリブレーションを行う
- 他のトランシーバを使用して任意の周波数（例えば7100.0KHz）でキャリアを発生させる。または、ローカル局に任意の周波数でキャリアを試験送信してもらう。
- キャリブレーションを行う前に、LSBモードでVFOを7100.0KHzに設定する（この時点では受信信号はゼロ・ビートになっていない）
- 3回ボタンを短く押して、LSBキャリブレーションモードに入る
- チューニング・ポットを使用して、正確にゼロ・ビートになるように調整を行う（ppm）
- ファンクションボタンを押して設定を記録する


### VFOキャリブレーション、USB

４回、短くボタンを押す－USBモードでのVFO周波数のキャリブレーションを行う

- USBキャリブレーションはLSBキャリブレーションに依存しますので、最初にLSBキャリブレーションが完了していることを確認してください。
- 他のトランシーバを使用して任意の周波数（例えば7100.0KHz）でキャリアを発生させる。または、ローカル局に任意の周波数でキャリアを試験送信してもらう
- キャリブレーションを行う前に、USBモードでVFOを7100.0KHzに設定する（この時点では受信信号はゼロ・ビートになっていない）
- ４回ボタンを短く押して、USBキャリブレーションモードに入る
- チューニング・ポットを使用して、正確にゼロ・ビートになるように調整を行う（ppm）
- ファンクションボタンを押して設定を記録する


### VFOドライブレベル，LSB

５回、ボタンを短く押す－LSBモードでのVFOドライブレベルを設定する

- 7199KHzに周波数を合わせる。ほとんどのBITX40のLSBモードでは強力な”birdie”が聞こえる
- ファンクションボタンを3回短く押してVFOドライブレベル調整モードに入る
- LSBモードでのドライブレベルの初期値は4mA
- チューニング・ポットを使用して、“birdie”の強さが小さくなるようにドライブレベルを選択する（2,4,6,8mA）
- ファンクションボタンを押して設定を記録する


### VFOドライブレベル，USB

６回、ボタンを短く押す－USBモードでのVFOドライブレベルを設定する

- 弱い信号を受信する
- ファンクションボタンを4回短く押してVFOドライブレベル調整モードに入る
- USBモードでのドライブレベルの初期値は8mA
- チューニング・ポットを使用して、信号のノイズ比が最大になるようにドライブレベルを選択する（2,4,6,8mA）
- ファンクションボタンを押して設定を記録する
　＊参考：USBモードでドライブレベルが最大の8mＡでも不十分な場合には、C91とC92を外すと改善するかもしれません。これらのコンデンサは高周波数でのVFO信号を低減しています。これらのコンデンサは実施にはアナログVFOのみに必要です。アナログVFOの代わりにRaduuinoのDDSを使用している場合には、これらのコンデンサは問題なく取り外すことができます。


### チューニング幅

７回、ボタンを短く押す－チューニング幅を設定する（最小周波数、最高周波数、周波数幅）

- チューニング・ポットを使用して、最小周波数を設定し、ファンクションボタンを押す。
- チューニング・ポットを使用して、最高周波数を設定し、ファンクションボタンを押す。ノブの周波数幅は初期値では50KHzです。これは１回転のポット（ポテンションメーター）であればOKですが、もし複数回転のポットを使用する場合にはポット幅を拡げることができます。
- チューニング・ポットを使用して、希望するポット幅を設定します。１回転ノブの場合には50KHz、10回転ノブの場合には200KHzが良いでしょう。もし、主にCWで運用する場合には、ポット幅は10～25KHzが良いでしょう。
-　ファンクションボタンを押して、設定を記録します。

### 設定の終了

１秒以上ボタンを押すと“SETTINGS”メニューが終了して、通常の[運用モード](#運用モード)に戻ります。
全ての設定はEEPROMに記録され、スタートアップ時に読み出されます。


## 設定初期値

設定を初期値に戻すには、電源投入時にファンクションボタンを押し続けます。設定初期値は以下の通りです。

* VFO キャリブレーション値: 0
* VFO キャリブレーション・オフセット (USB): 1500 Hz
* VFO ドライブレベル (LSB):4mA
* VFO ドライブレベル (USB):8mA
* 最小周波数: 7000 kHz
* 最高周波数: 7300 kHz
* ポット幅: 50 kHz
* 運用モード：VFO　A/Bとも LSBモード
* CW サイドトーン: 800 Hz
* CW キータイプ:　ストレートキー
* タッチセンサー: OFF
* Auto-space: OFF
* semiQSK: ON
* QSK delay: 350 ms
* スキャン下限周波数: 7100 kHz
* スキャン上限周波数: 7150 kHz
* スキャン幅: 1 kHz
* スキャン遅延時間: 500 ms

ＶＦＯキャリブレーションを行わないと、“VFO uncalibrated”(VFOのキャリブレーション未実施)の注意メッセージが表示されます。


